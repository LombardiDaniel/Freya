#include <DallasTemperature.h>
#include <OneWire.h>
#include <DS3231.h>
#include <Stepper.h>
#include <SD.h>
#include <SPI.h>

/*Pins*/
#define pin_temp = 2;
#define pin_moist; //(analog)
#define pin_light_sensor; //(analog)
#define pin_hose; //(digital)
#define pinCS; //analog

/*Variables*/
const int stepsPerRevolution = 64;
int minuto, minuto_ant;
int X;
int min_moist; // valor de 0-100 (%)

/*Objects*/
File myFile;
OneWire oneWire(pin_temp);
DallasTemperature term(&oneWire);
Stepper myStepper(stepsPerRevolution, 8,10,9,11); //pinos do stepper
Time t;
DS3231 rtc(SDA, SCL);

void setup() {

  Serial.begin(9600);

  pinMode(pin_temp, INPUT);
  pinMode(pin_moist, INPUT);
  pinMode(pin_light_sensor, INPUT);
  pinMode(pin_hose, OUTPUT);
  pinMode(pinCS, OUTPUT);

  SD.begin();
  rtc.begin();
  term.begin();

  if (SD.begin()) {
    myFile = SD.open("data_")
  }

}

void loop() {

  t = rtc.getTime();
  X = t.hour + (t.min)*100/60;

  if (X == 6.0 && moist <= min_moist) { //por 10 min sÃ³ (?) ou depende da mosit

    water();

  } else if (x == 6.17) {

    water_stop();

  }

  //stopped here

  minuto = t.min;
  if (minuto != minuto_ant) {
    minuto_ant = minuto;
    log_data();
  }

}

moist moist() {

  float moist;

  for (int i = 0; i < 100; i++) {
    humitty += analogRead(pin_moist);
    delay(1);
  }

  moist = (- (moist)/6.71 + 100)/50;

  if (moist > 100) {
    moist = 100;
  } else if (moist < 0) {
    moist = 0;
  }

  return moist;
}

float temp() {

  term.requestTemperatures();
  temp = term.getTempCByIndex(0);

  retrun temp;

}

long lux() {

  long luz;

  luz = analogRead(pin_light_sensor);

  return luz;
}

void water() {

  digitalWrite(pin_hose, HIGH);

}

void water_stop() {

  digitalWrite(pin_hose, HIGH);

}

void log_data() {

  t = rtc.getTime

}
